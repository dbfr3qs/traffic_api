
<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>


<div id="container" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
<button id="addNew">Show PM</button>

<script type="text/javascript">

function GetData(suburb, period) {
    var xhr = new XMLHttpRequest();
    var url = "http://localhost:3000/api/v1/etas";
    params = "suburb=" + suburb + "&period=" + period;
    xhr.open("POST", url, false);
    xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhr.send(params);

    var result = JSON.parse(xhr.responseText);
    return result;
}

$(function() {
    
    $('#container').highcharts({
        title: {
            text: 'Average ETA',
            x: -20 //center
        },
        subtitle: {
            text: 'Source: NZTA Wellington',
            x: -20
        },
        xAxis: {
            title: {
                text: 'Days'
            },
            categories: GetData('Melling', 'PM')[0]
        },
        yAxis: {
            title: {
                text: 'Time in minutes'
            },
            plotLines: [{
                value: 0,
                width: 1,
                color: '#808080'
            }]
        },
        tooltip: {
            valueSuffix: ' Minutes'
        },
        legend: {
            layout: 'vertical',
            align: 'right',
            verticalAlign: 'middle',
            borderWidth: 0
        },
        series: [{
            name: 'Melling AM',
            data: GetData('Melling', 'AM')[1]
        }, {
            name: 'Porirua AM',
            data: GetData('Porirua', 'AM')[1]
        }, {
            name: 'Petone AM',
            data: GetData('Petone', 'AM')[1]
        }, {
            name: 'Manor Park AM',
            data: GetData('Manor Park', 'AM')[1]
        }, {
            name: 'JVille AM',
            data: GetData('JVille', 'AM')[1]
        }, {
            name: 'Paekak AM',
            data: GetData('Paekak', 'AM')[1]
        }]
            
    });
    
    $('#addNew').on('click', function(e) {
        var period = "";
        console.log($(this).text());

        if ($(this).text() == "Show PM") {
            period = "PM";
            console.log($(this).text());
            console.log(period);

        } 
        else if ($(this).text() == "Show AM") {            
            period = "AM";
            console.log($(this).text());
            console.log(period);
        }

        var chart = $('#container').highcharts();
        chart.series[0].setData(GetData('Melling', period)[1], false);
        chart.series[0].update({ name: "Melling " + period }, false);
        chart.series[1].setData(GetData('Porirua', period)[1], false);
        chart.series[1].update({ name: "Porirua " + period }, false);
        chart.series[2].setData(GetData('Petone', period)[1], false);
        chart.series[2].update({ name: "Petone " + period }, false);
        chart.series[3].setData(GetData('Manor Park', period)[1], false);
        chart.series[3].update({ name: "Manor Park " + period }, false);
        chart.series[4].setData(GetData('JVille', period)[1], false);
        chart.series[4].update({ name: "JVille " + period }, false);
        chart.series[5].setData(GetData('Paekak', period)[1], false);
        chart.series[5].update({ name: "Paekak " + period }, false);
        
        if (period == "PM") { 
            $('#addNew').html('Show AM'); 
        }

        if (period == "AM") {
            $('#addNew').html('Show PM');
        }
        $('#container').highcharts().redraw();
    });
});
</script>